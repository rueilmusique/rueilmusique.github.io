<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Donn√©es Google Sheets (API s√©curis√©e)</title>
	<!-- <link rel="stylesheet" href="assets/css/main.css" /> -->
	<!-- <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript> -->
  <style>
    <!-- body { font-family: sans-serif; margin: 40px; } -->
    <!-- .instruDesc { margin-bottom: 15px; padding: 15px; background: #f7f7f7; border-radius: 8px; } -->
    <!-- h3 { margin: 0 0 8px; } -->
  </style>
</head>
<body>
  <h1>Donn√©es priv√©es Google Sheets</h1>
  <div id="main">
</div>

<script>
const sheetId = "1SzC6ugoz_1HxBOejbxCQYPnFxyqKqEtws5IPXmJOjuE"; // ID du document
const range = "GuitareClassique!A2:AE"; // lignes √† lire (A2 √† C‚Ä¶)
const apiKey = "AIzaSyDy7yHR-YxZ8rlgamlIQfIWZGyHNjkmX2o"; // ta cl√© API Google Cloud

fetch(`https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${range}?key=${apiKey}`)
.then(res => res.json())
.then(data => {
const container = document.getElementById("main");

// Cr√©e un objet pour regrouper les guitares par gamme
const guitarsByRange = {};

// Parcours les lignes et groupe les guitares par gamme
data.values.forEach(row => {
const [ID, Marque, Nom, Update, Vendue, Gamme, Prix, Coloris, Sous_mod√®le, Description_BaseArticle, Description_Web, Blockquote, Blockquote_equipe, Remarques, Table, Corps, Manche, Touche, Chevalet, M√©caniques, √âlectronique, √âclisses, Dos, Vernis, Finition, Plaque, Sillet, Autres, Pays_texte, Pays_image, Visible] = row;

// üõë Si pas de nom ou d‚Äôimage : on saute
if (!ID || !Gamme) return;
// Si le mod√®le n‚Äôest pas visible, on le saute
if (Visible !== "TRUE") return;

// Si la gamme n'existe pas encore, on la cr√©e
if (!guitarsByRange[Gamme] || !Array.isArray(guitarsByRange[Gamme])) {
	<!-- guitarsByRange[Gamme] = { paragrapheGamme: Paragraphe_gamme, items: [] }; -->
	guitarsByRange[Gamme] = [];
	}

// Ajoute la guitare au groupe correspondant √† sa gamme
guitarsByRange[Gamme].push({
ID, Marque, Nom, Update, Vendue, Gamme, Prix, Coloris, Sous_mod√®le, Description_BaseArticle, Description_Web, Blockquote, Blockquote_equipe, Remarques, Table, Corps, Manche, Touche, Chevalet, M√©caniques, √âlectronique, √âclisses, Dos, Vernis, Finition, Plaque, Sillet, Autres, Pays_texte, Pays_image
});
});

// Parcours les gammes et affiche chaque guitare
Object.keys(guitarsByRange).forEach(gamme => {
	// Cr√©e un <h2> pour la gamme
	const { paragrapheGamme, items } = guitarsByRange[gamme];
	const gammeSection = document.createElement("div");
	gammeSection.innerHTML = `<h2 class="gammeGuitare">${gamme}</h2>${paragrapheGamme ? '<p class="introGamme">${paragrapheGamme}</p>' : ""}`;

	// Pour chaque guitare dans cette gamme
	guitarsByRange[gamme].forEach(guitar => {
	const caracteristiques = [
	["Table", guitar.Table],
	["Corps", guitar.Corps],
	["Manche", guitar.Manche],
	["Touche", guitar.Touche],
	["Chevalet", guitar.Chevalet],
	["M√©caniques", guitar.M√©caniques],
	["√âlectronique", guitar.√âlectronique],
	["√âclisses", guitar.√âclisses],
	["Dos", guitar.Dos],
	["Vernis", guitar.Vernis],
	["Finition", guitar.Finition],
	["Plaque", guitar.Plaque],
	["Sillet", guitar.Sillet],
	["Autres", guitar.Autres],
	];

	// On ne garde que celles qui ont une valeur non vide
	const listItems = caracteristiques
	.filter(([label, value]) => value && value.trim() !== "")
	.map(([label, value]) => `<li><b>${label}</b> : ${value}</li>`)
	.join("");

	// Blockquote affich√© uniquement si non vide
	const quoteHtml = guitar.Blockquote && guitar.Blockquote.trim() !== ""
	? `<blockquote class="${guitar.Blockquote_equipe}">¬´ ${guitar.Blockquote} ¬ª</blockquote>`
	: "";

	// Cr√©e la carte pour la guitare
	const card = document.createElement("div");
	card.className = "instruDesc";
	card.innerHTML = `
	<h3>${guitar.Marque} - ${guitar.Nom}</h3>
	<div class="inner">
		<section>
			<span class="image fit">
			<img src="images/classic-guitars/${guitar.ID}.jpg" loading="lazy" alt="Guitare √©lectrique ${guitar.Marque} ${guitar.Nom}" />
			</span>
			<a class="callRueil button small fit icon solid fa-phone"></a>
		</section>
		<section>
			<p>${guitar.Description_Web}</p>
			<ul>${listItems}</ul>
			${quoteHtml}
		</section>
	</div>				
	`;
	
	const retourLigneArticle = document.createElement("hr");

	gammeSection.appendChild(card);
	gammeSection.appendChild(retourLigneArticle);
	});

	// Ajoute la section de la gamme au container
	container.appendChild(gammeSection);
	
	const retourLigneGamme = document.createElement("br");
	gammeSection.appendChild(retourLigneGamme);
	});
})
.catch(err => console.error(err));
</script>

</body>
</html>
